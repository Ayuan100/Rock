{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/greet.ts","src/lib/Rock.ts","src/lib/map.ts","src/lib/renderer.ts","src/lib/scanner.ts","src/lib/view-model.ts","src/lib/watcher.ts","src/main.ts"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","sayHello","name","scanner_1","watcher_1","renderer_1","Rock","prefix","this","scanner","Scanner","viewModelPool","prototype","registerViewModel","alias","model","console","log","push","Array","getViewModel","init","watcher","Watcher","observe","render","mapList","scan","renderer","Renderer","Map","element","list","mappingList","Mapping","rock_attr","viewmodel","vm_attr","rock","map","mapping","innerHTML","style","left","top","onmousemove","move","map_1","map_2","allChildren","document","querySelectorAll","child","j","attributes","attr","nodeName","search","substring","indexOf","result","value","split","ViewModel","x","y","text","pageX","pageY","pool","callback","viewModel","defaultValue","Object","defineProperty","get","set","Rock_1","view_model_1","myRock","window"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","export function sayHello(name: string) {\n    return `Hello from ${name}`;\n}","import { Scanner } from \"./scanner\";\nimport { Watcher } from \"./watcher\";\nimport { Renderer } from \"./renderer\";\nimport { ViewModel } from \"./view-model\";\nimport { Map } from \"./map\"\n\nexport let Rock = class Rock {\n\t\n\tprefix:string = 'rock-';\n\tprivate scanner :Scanner;\n\tprivate watcher :Watcher;\n\tprivate viewModelPool :object;\n\tprivate mapList :Array<Map>;\n\tprivate renderer : Renderer;\n\n\tprivate rockElements:Array<HTMLElement>;\n\n\n\tconstructor(prefix:string) {\n\t\tif(prefix) this.prefix = prefix + '-';\n\t\tthis.scanner = new Scanner(this);\n\t\tthis.viewModelPool = {};\n\t\t\n\t\t\n\t}\n\n\t// 把注册的viewmodel加入pool\n\tpublic registerViewModel( alias:string, model: object){\n\t\tconsole.log('register view model: ', alias);\n\t\tif(this.viewModelPool[alias]) this.viewModelPool[alias].push(model);\n\t\telse this.viewModelPool[alias] = new Array(model);\n\t\tconsole.log(this.viewModelPool);\n\t}\n\tpublic getViewModel(alias :string){\n\t\treturn this.viewModelPool[alias][0];\n\t}\n\tpublic init(){\n\t\tconsole.log('init---------------');\n\t\tthis.watcher = new Watcher(this, this.viewModelPool);\n\t\tconsole.log('new watcher:', this.watcher);\n\t\tthis.watcher.observe(this.render);\n\n\t\t// console.log('?');\n\t\tthis.mapList = this.scanner.scan();\n\t\tthis.renderer = new Renderer(this, this.mapList);\n\t\tthis.render();\n\n\t\t// this.watcher.observe(this.rockElements);\n\t}\n\tpublic render(){\n\t\tconsole.log('render',this);\n\t\tif(this.mapList){\n\t\t\tfor( let i = 0; i < this.mapList.length; i++){\n\t\t\t\tthis.renderer.render(this.mapList[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\n}\n\n\n","\nexport class Map{\n\telement :HTMLElement;\n\tmappingList :Array<Mapping>;\n\tconstructor(element:HTMLElement, list:Array<Mapping>){\n\t\tthis.element = element;\n\t\tthis.mappingList = [];\n\t\tif(list) this.mappingList = list;\n\t}\n}\n\nexport class Mapping{\n\tviewmodel :object;\n\trock_attr :string;\n\tvm_attr : string;\n\tconstructor(rock_attr:string, viewmodel:object, vm_attr:string){\n\t\tthis.viewmodel = viewmodel;\n\t\tthis.rock_attr = rock_attr;\n\t\tthis.vm_attr = vm_attr;\n\t}\n}","import { Map } from \"./map\"\nexport class Renderer {\n\tprivate rock :object;\n\tprivate mapList : Array<object>;\n\tconstructor(rock :object, mapList :Array<object>){\n\t\tthis.rock = rock;\n\t\tthis.mapList = mapList;\n\t}\n\tpublic render(map :Map){\n\t\tconsole.log('render');\n\t\tlet list = map.mappingList;\n\t\tlet element = map.element;\n\t\tfor(let i = 0; i < list.length; i++){\n\t\t\tlet mapping = list[i];\n\t\t\tlet viewmodel = mapping.viewmodel;\n\t\t\t// console.log(viewmodel);\n\t\t\tswitch(mapping.rock_attr){\n\t\t\t\tcase 'text':\n\t\t\t\t\telement.innerHTML = viewmodel[mapping.vm_attr];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'x':\n\t\t\t\t\telement.style.left = viewmodel[mapping.vm_attr] + 'px';\n\t\t\t\t\t// console.log(element.style['left']);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'y':\n\t\t\t\t\telement.style.top = viewmodel[mapping.vm_attr] + 'px';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'onmousemove':\n\t\t\t\t\telement.onmousemove = viewmodel.move;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log(mapping.rock_attr, ' to render');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n}","import { Map } from \"./map\"\nimport { Mapping } from \"./map\"\n\nexport class Scanner {\n\tprivate prefix = \"rock-\";\n\tprivate rock :object;\n\n\tconstructor(rock :object) {\n\t\tthis.rock = rock;\n        this.prefix = rock.prefix;\n\t}\n\n\t// \n\tpublic scan() :Array<Map>{\n\t\tconsole.log('scan--------');\n        let mapList : Array<Map> =[];\n        // 扫描所有元素\n\t\tlet allChildren = document.querySelectorAll(\"*\");\n\t\tfor (let i = 0; i < allChildren.length; i++) {\n            let child: HTMLElement = allChildren[i] as HTMLElement;\n            let mappingList: Array<Mapping> = [];\n            // 扫描所有attribute找到mapping\n            for (let j = 0; j < child.attributes.length; j++) {\n                let attr = child.attributes[j];\n                // console.log('attr:',attr);\n                // 把带prefix的属性加到mapping\n                if (attr.nodeName.search(this.prefix) > -1) {\n                    let rock_attr = attr.nodeName.substring(attr.nodeName.indexOf('-')+1);\n                    // 解析vm.xxx\n                    let result = attr.value.split(/\\./);\n\n                    if(result.length > 1){\n                        let alias :string = result[0];\n                        let vm_attr = result[1];\n                        // 匹配已注册的view model\n                        let viewmodel = this.rock.getViewModel(alias);\n                        if(viewmodel){\n                            // 加入mapping\n                            mappingList.push(new Mapping(rock_attr, viewmodel, vm_attr));\n                            // console.log('add alias:',alias,' attr:',rock_attr);\n                        }\n                    } \n                }\n            }\n            // 加入map\n            if(mappingList.length > 0) mapList.push(new Map(child, mappingList));\n        }\n        // console.log(mapList);\n        return mapList;\n\t}\n}","export class ViewModel {\n\tx :number = 0;\n\ty :number = 0;\n\ttext :string = null;\n\tconstructor(x, y, text){\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.text = text;\n\t}\n\tmove(e:Event){\n\t\t// console.log(e);\n\t\tthis.x = e.pageX;\n\t\tthis.y = e.pageY;\n\t\tconsole.log(this);\n\t}\n}","export class Watcher {\n\tprivate rock :object;\n\tprivate pool :object;\n\tconstructor(rock:Object, pool:Array<object>){\n\t\tthis.rock = rock;\n\t\tthis.pool = pool;\n\t}\n\tpublic observe(callback:Function) {\n\t\tconsole.log('observe pool:', this.pool);\n\t\tlet rock = this.rock;\n\t\tfor(let alias in this.pool){\n\t\t\tlet viewModel = this.pool[alias][0];\n\t\t\tconsole.log('observe viewmodel:', viewModel, callback);\n\t\t\tfor(let attr in viewModel){\n\t\t\t\tlet defaultValue = viewModel[attr];\n\t\t\t\tObject.defineProperty(viewModel, attr, {\n\t                get: function () {\n\t                    return defaultValue;\n\t                },\n\t                set: function (value) {\n\t                \tdefaultValue = value;\n\t                    console.log(\"do something after set a new value\");\n\t                    callback.call(rock);\n\t                }\n\t            });\n\t\t\t}\n            \n\n\t\t}\n\t}\n}","import { sayHello } from \"./greet\";\nimport { Rock } from \"./lib/Rock\";\nimport { ViewModel } from \"./lib/view-model\"\n\nfunction showHello(divName: string, name: string) {\n    const elt = document.getElementById(divName);\n    elt.innerText = sayHello(name);\n}\n\nconsole.log('hey, it is me???');\n\n// showHello(\"greeting\", \"TypeScript update\");\nlet myRock = new Rock('rock');\nlet viewModel = new ViewModel(50,100,'I am ViewModel!');\nmyRock.registerViewModel('vm', viewModel);\nmyRock.init();\nwindow.viewModel = viewModel;\nviewModel.x = 200;\nviewModel.x = 400;\n// setInterval(\"viewModel.x += 5;\", 1000);\n"]}